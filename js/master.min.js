const softwareVersion="v1.2.1";Date.prototype.stdTimezoneOffset=function(){var e=new Date(this.getFullYear(),0,1),t=new Date(this.getFullYear(),6,1);return Math.max(e.getTimezoneOffset(),t.getTimezoneOffset())},Date.prototype.isDstObserved=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};const standardSettings={showCountdownInTitle:!0,showExactCountdown:!1},localStorageItemName="settings",title="Sober October Countdown";var currentSettings={},currentLocalDate=new Date,mainTextElement=document.getElementById("mainText"),settingsContainerElements=document.getElementById("settingsContainer").querySelectorAll(".checkbox"),settingsButtonElement=document.getElementById("settingsButton"),settingsPanelElement=document.getElementById("settingsPanel"),settingsApplyElement=document.getElementById("settingsApply"),settingsCancelElement=document.getElementById("settingsCancel"),settingsPersonalLinkElement=document.getElementById("settingsPersonalLink"),titleElement=document.getElementsByTagName("title")[0];function daysBetween(e,t){e.isDstObserved()&&!t.isDstObserved()?e.setHours(e.getHours()+1):!e.isDstObserved()&&t.isDstObserved()&&e.setHours(e.getHours()-1);const n=Math.abs(e-t);return Math.floor(n/864e5)+1}function getDayCountdown(){if(9==currentLocalDate.getMonth())return daysBetween(new Date(currentLocalDate.getFullYear(),10,1),currentLocalDate);var e=currentLocalDate.getFullYear();return currentLocalDate.getMonth()+1>10&&e++,daysBetween(new Date(e,9,1,0,0,0),currentLocalDate)}function setDayCountdown(){if(mainTextElement.querySelector(":nth-child(1)").innerHTML="There is",9==currentLocalDate.getMonth()){var e=getDayCountdown();mainTextElement.querySelector(":nth-child(2)").innerHTML=e,mainTextElement.querySelector(":nth-child(2)").innerHTML+=" day",31!=currentLocalDate.getDate()&&(mainTextElement.querySelector(":nth-child(2)").innerHTML+="s"),mainTextElement.querySelector(":nth-child(3)").innerHTML="until Sober October ends."}else{e=getDayCountdown();mainTextElement.querySelector(":nth-child(2)").innerHTML=e,mainTextElement.querySelector(":nth-child(2)").innerHTML+=" day",1!=e&&(mainTextElement.querySelector(":nth-child(2)").innerHTML+="s"),mainTextElement.querySelector(":nth-child(3)").innerHTML="until Sober October starts."}}function setExactCountdown(){var e;if(mainTextElement.querySelector(":nth-child(1)").innerHTML="There is",9==currentLocalDate.getMonth())e=new Date(currentLocalDate.getFullYear(),10,1),mainTextElement.querySelector(":nth-child(3)").innerHTML="until Sober October ends.";else{var t=currentLocalDate.getFullYear();currentLocalDate.getMonth()+1>10&&t++,e=new Date(t,9,1,0,0,0),mainTextElement.querySelector(":nth-child(3)").innerHTML="until Sober October starts."}const n=Math.ceil(Math.abs(currentLocalDate-e)/1e3),o=`${Math.floor(n/60/60/24)} d. ${Math.floor(n/60/60%24)} h. ${Math.floor(n/60%60)} m. ${Math.floor(n%60)} s.`;mainTextElement.querySelector(":nth-child(2)").innerHTML=o}function getSetting(e){return currentSettings[e]}function setSetting(e,t){"true"==t?t=!0:"false"==t&&(t=!1),currentSettings[e]=t;let n=JSON.parse(localStorage.getItem(localStorageItemName));n[e]=t,localStorage.setItem(localStorageItemName,JSON.stringify(n))}function showPersonalLink(){let e=window.location.origin,t="?";for(var n=0;n<settingsContainerElements.length;n++){let e=settingsContainerElements[n].querySelector("input");t+=e.name,t+="=",e.checked?t+="true":t+="false",n!=settingsContainerElements.length-1&&(t+="&")}window.prompt("Copy to clipboard",e+t)}function updateLoop(){currentLocalDate=new Date,getSetting("showCountdownInTitle")?titleElement.innerHTML="("+getDayCountdown()+") "+title:titleElement.innerHTML!=title&&(titleElement.innerHTML=title),getSetting("showExactCountdown")?setExactCountdown():setDayCountdown()}document.getElementById("softwareVersion").innerHTML="v1.2.1";var queryDict={};location.search.substr(1).split("&").forEach(function(e){queryDict[e.split("=")[0]]=e.split("=")[1]}),localStorage.getItem(localStorageItemName)?localStorage.getItem(localStorageItemName)&&(currentSettings=JSON.parse(localStorage.getItem(localStorageItemName))):(currentSettings=standardSettings,localStorage.setItem(localStorageItemName,JSON.stringify(standardSettings)));for(let e in standardSettings)e in queryDict&&queryDict[e].toString()!=currentSettings[e].toString()&&setSetting(e,queryDict[e]);for(var i=0;i<settingsContainerElements.length;i++){let e=settingsContainerElements[i].querySelector("input");1==currentSettings[e.name]?e.checked=!0:e.checked=!1}settingsButtonElement.addEventListener("click",function(){settingsPanelElement.style.display="block"}),settingsApplyElement.addEventListener("click",function(){for(var e=0;e<settingsContainerElements.length;e++){let t=settingsContainerElements[e].querySelector("input");1==t.checked?setSetting(t.name,!0):setSetting(t.name,!1)}settingsPanelElement.style.display="none"}),settingsCancelElement.addEventListener("click",function(){settingsPanelElement.style.display="none"}),settingsPersonalLinkElement.addEventListener("click",function(){showPersonalLink()}),document.onkeydown=function(e){27==(e=e||window.event).keyCode&&("none"==settingsPanelElement.style.display?settingsPanelElement.style.display="block":settingsPanelElement.style.display="none")},updateLoop(),window.setInterval(function(){updateLoop()},1e3);
